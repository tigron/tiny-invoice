{% extends "_default/layout.base.twig" %}

{% import '_default/macro.base.twig' as base %}

{% block content %}

	{% if action == 'edit' %}

		{% include 'sales/invoice/queue/recurring/edit.twig' %}

	{% elseif action == 'add_step3' %}

		{% include 'sales/invoice/queue/recurring/create/step3.twig' %}

	{% elseif action == 'add_step2' %}

		{% include 'sales/invoice/queue/recurring/create/step2.twig' %}

	{% elseif action == 'add_step1' %}

		{% include 'sales/invoice/queue/recurring/create/step1.twig' %}

	{% else %}
		<div class="row">
			<div class="col">
				<h4>{% trans "Recurring Invoice Queue" %}</h4>
			</div>
		</div>

		<form class="form-horizontal" method="post" action="/sales/invoice/queue/recurring">
			<div class="card mb-3">
				<div class="card-header">
					{% trans "Filter" %}
				</div>
				<div class="card-body">
					<div class="row mb-1 mb-md-3">
						<label class="col-form-label col-12 col-md-3 text-md-end">{% trans "Search" %}</label>
							<div class="col-9">
							<input type="text" class="form-control" name="search" value="{{ pager.get_search() }}" data-default="" />
						</div>
					</div>


					<div class="row mb-1 mb-md-3">
						<div class="controls offset-2 col-5">
							<button class="btn btn-primary" type="submit">
								{% trans "Search" %}
							</button>
						</div>
					</div>
				</div>
			</div>
		</form>

		<div class="card">
			<div class="card-header">
				{{ base.pager_count(pager.item_count) }}

				<span class="pull-right">
					<a href="?action=add_step1">
						<i data-feather="plus"></i> {% trans "Create recurring invoice queue" %}
					</a>
				</span>
			</div>
			<div class="card-body">

			{% for queue in pager.items %}
				{% if loop.first %}
						<table class="table table-striped table-hover table-condensed">
						<thead>
							<tr>
								<th width="50">{{ pager.create_header('Id'|trans, 'id')|raw }}</th>
								<th>{{ pager.create_header('Created'|trans, 'created')|raw }}</th>
								<th>{{ pager.create_header('Next run'|trans, 'next_run')|raw }}</th>
								<th>{{ pager.create_header('Stop after'|trans, 'stop_after')|raw }}</th>
								<th>{{ pager.create_header('Customer'|trans, 'customer_id')|raw }}</th>
								<th>{{ pager.create_header('Contact'|trans, 'invoice_customer_contact_id')|raw }}</th>
								<th>{{ pager.create_header('Name'|trans, 'name')|raw }}</th>
								<th class="text-right">{{ pager.create_header('Price'|trans, 'price')|raw }}</th>
								<th width="20">&nbsp;</th>
								<th width="30"></th>
								<th width="30"></th>
							</tr>
						</thead>
						<tbody>
				{% endif %}

				<tr {% if queue.next_run >= queue.stop_after and queue.stop_after is not null %}class="warning"{% endif %}>
					<td>{{ queue.id }}</td>
					<td>{{ queue.created|date("d/m/Y") }}</td>
					<td>{{ queue.next_run|date("d/m/Y") }}</td>
					<td>{% if queue.stop_after is null %}<i>{% trans "never" %}</i>{% else %}{{ queue.next_run|date("d/m/Y") }}{% endif %}</td>
					<td><a href="/administrative/customer/detail?id={{  queue.customer.id }}">{{ queue.customer.get_display_name() }}</a></td>
					<td>{{ queue.customer_contact.get_display_name() }}</td>
					<td>{{ queue.name|truncate(50, true) }}</td>
					<td class="text-right">&euro;&nbsp;{{ queue.get_total_price()|number_format }}</td>
					<td>&nbsp;</td>
					<td>
						<a href="/sales/invoice/queue/recurring?action=edit&id={{ queue.id }}">
							<i data-feather="edit"></i>
						</a>
					</td>
					<td>
						<a href="/sales/invoice/queue/recurring?action=delete&id={{ queue.id }}" data-confirm-title="{% trans "Please confirm" %}" data-confirm-message="{% trans "Are you sure you want to delete the recurring invoice queue selected" %}?">
							<i data-feather="trash-2"></i></span>
						</a>
					</td>
				</tr>

				{% if loop.last %}
						</tbody>
						</table>

						{{ pager.links|raw }}
				{% endif %}
			{% else %}
				<p><em>{% trans "No recurring invoice queue items found." %}</em></p>
			{% endfor %}

			</div>
		</div>
	{% endif %}

{% endblock content %}

