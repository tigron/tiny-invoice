{% import '_default/macro.base.twig' as base %}
{% import '_default/form.base.twig' as form %}

<div class="row">
	<div class="col">
		<h4>{% trans "Customers" %}</h4>
	</div>
	<div class="col">
		<div class="float-md-end">
			<nav aria-label="breadcrumb">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="/administrative/customer">
							{% trans "Customer" %}
						</a>
					</li>
					<li class="breadcrumb-item active">
						{% trans "Add customer" %}
					</li>
				</ol>
			</nav>
		</div>
	</div>
</div>

{% if errors is defined %}
	{{ base.alert('danger', "The form contains mistakes. Please correct them."|trans) }}
{% endif %}

<form class="form form-horizontal form-condensed" method="post" action="/administrative/customer?action=add">
	<div class="card">
		<div class="card-body">
			<div class="row offset-md-2">
				<div class="col-md-10">
					<div class="form-floating">
						<input type="text" name="customer[company]" id="company" class="form-control {% if 'company' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.company }}" placeholder="{% trans "Company" %}">
						<label class="form-label col-2" for="company">{% trans "Company" %}</label>
						{{ form.invalid_input('company', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2">
				<div class="col-md-6 mt-2">
					<div class="form-floating">
						<input type="text" name="customer[firstname]" id="firstname" class="form-control {% if 'firstname' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.firstname }}" placeholder="{% trans "Firstname" %}" %>
						<label for="firstname" class="col-form-label">{% trans "Firstname" %}</label>
						{{ form.invalid_input('firstname', errors) }}
					</div>
				</div>

				<div class="col-md-4 mt-2">
					<div class="form-floating">
						<input type="text" name="customer[lastname]" id="firstname" class="form-control {% if 'lastname' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.lastname }}" placeholder="{% trans "Lastname" %}">
						<label for="lastname" class="col-form-label">{% trans "Lastname" %}</label>
						{{ form.invalid_input('lastname', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2">
				<div class="col-md-7 mt-2">
					<div class="form-floating">
						<input type="text" name="customer[street]" id="street" class="form-control {% if 'street' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.street }}" placeholder="{% trans 'Street' %}">
						<label for="street" class="col-form-label">{% trans "Street" %}</label>
						{{ form.invalid_input('street', errors) }}
					</div>
				</div>

				<div class="col-md-3 mt-2">
					<div class="form-floating">
						<input type="text" name="customer[housenumber]" id="housenumber" class="form-control {% if 'housenumber' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.housenumber }}" placeholder="{% trans 'Housenumber' %}">
						<label for="housenumber" class="col-form-label">{% trans "Housenumber" %}</label>
						{{ form.invalid_input('housenumber', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2">
				<div class="col-md-5 mt-2">
					<div class="form-floating">
						<input type="text" name="customer[zipcode]" id="zipcode" class="form-control {% if 'zipcode' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.zipcode }}" placeholder="{% trans 'Zip code' %}">
						<label for="zipcode" class="col-form-label">{% trans "Zip code" %}</label>
						{{ form.invalid_input('zipcode', errors) }}
					</div>
				</div>

				<div class="col-md-5 mt-2">
					<div class="form-floating">
						<input type="text" name="customer[city]" id="city" class="form-control {% if 'city' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.city }}" placeholder="{% trans 'City' %}">
						<label for="city" class="col-form-label">{% trans "City" %}</label>
						{{ form.invalid_input('city', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2">
				<div class="col-md-10 mt-2">
					<div class="form-floating">
						<select name="customer[country_id]" id="country_id" class="form-control select2 " onchange="change_country();" placeholder="{% trans 'Country' %}">
						{% for group in countries|keys  %}
							{% if group == 'european' %}
								<optgroup label="{% trans "European" %}">
							{% else %}
								<optgroup label="{% trans "Rest of the world" %}">
							{% endif %}

							{% for country in countries[group] %}
								<option value="{{ country.id }}" data-iso2="{{ country.iso2 }}" {% if env.post.customer.country_id == country.id %}selected="selected"{% elseif env.post.customer.country_id is not defined and country.id == 203 %}selected="selected"{% endif %}>{{ attribute(country, 'text_' ~ env.language.name_short ~ '_name') }}</option>
							{% endfor %}
							</optgroup>
						{% endfor %}
						</select>
						<label for="country_id" class="col-form-label">{% trans "Country" %}</label>
						{{ form.invalid_input('country_id', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2 mt-2">
				<div class="col-md-10">
					<div class="form-floating">
						<input type="text" name="customer[email]" id="email" class="form-control {% if 'email' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.email }}" placeholder="{% trans "Email" %}">
						<label class="col-form-label col-2" for="email">{% trans "Email" %}</label>
						{{ form.invalid_input('email', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2">
				<div class="col-md-5 mt-2">
					<div class="form-floating">
						<input type="tel" name="customer[phone]" id="phone" class="form-control {% if 'phone' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.phone }}"  placeholder="{% trans "Phone" %}">
						<label for="city" class="col-form-label">{% trans "Phone" %}</label>
						{{ form.invalid_input('phone', errors) }}
					</div>
				</div>

				<div class="col-md-5 mt-2">
					<div class="form-floating">
						<input type="tel" name="customer[mobile]" id="mobile" class="form-control {% if 'mobile' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.mobile }}" placeholder="{% trans "Mobile" %}">
						<label for="city" class="col-form-label">{% trans "Mobile" %}</label>
						{{ form.invalid_input('mobile', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2 mt-2">
				<div class="col-md-10">
					<div class="input-group">
						<span class="input-group-text" id="vat_prefix" readonly/>AT</span>
						<div class="form-floating">
							<input type="text" name="customer[vat]" id="vat" class="form-control {% if 'vat' in errors|keys %}is-invalid{% endif %}" value="{{ env.post.customer.vat }}" placeholder="{% trans 'Vat' %}">
							<label for="vat" class="col-form-label">{% trans 'Vat' %}</label>
						</div>
					</div>
				</div>
			</div>

			<div class="row offset-md-2 mt-2">
				<div class="col-md-10">
					<div class="form-floating">
						<select name="language_id" class="form-control select2" id="{{ id }}">
							{% for language in languages %}
								<option value="{{ language.id }}"{% if language.id == env.post.language_id %} selected{% endif %}>{{ language.name }}</option>
							{% endfor %}
						</select>
						<label for="language_id" class="col-form-label">{% trans "Language" %}</label>
						{{ form.invalid_input('language_id', errors) }}
					</div>
				</div>
			</div>

			<div class="row offset-md-2 mt-2">
				<div class="col-md-10">
					<div class="form-floating">
						<textarea name="customer[comment]" class="form-control">{{ env.post.customer.comment }}</textarea>
						<label for="comments" class="col-form-label">{% trans "Comments" %}</label>
						{{ form.invalid_input('email', errors) }}
					</div>
				</div>
			</div>

			<div class="row input-group offset-md-2 mt-2">
				<div class="col-md-10">
					<button class="btn btn-primary">
						{% trans "Save" %}
					</button>
				</div>
			</div>

		</div>
	</div>
</form>
<script type="text/javascript">
	function change_country() {
		iso2 = $('select[name="customer[country_id]"] option:selected').attr('data-iso2');
		$('#vat_prefix').text(iso2);
	}
	change_country();
</script>

